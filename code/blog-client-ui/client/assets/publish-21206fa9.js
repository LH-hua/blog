import{T as $}from"./toastui-editor-1a4c2a60.js";import{g as z,d as G}from"./article-fb1a7804.js";import{_ as K,r as g,b as L,J as O,o as Q,c as a,d as B,e as R,g as e,w as t,h as I,y as C,j as d,t as W,l as X,A as Y,I as Z,v as ee,x as te}from"./index-1c70507a.js";const ae=v=>(ee("data-v-235aea46"),v=v(),te(),v),oe={class:"main"},le=ae(()=>I("div",{id:"editor"},null,-1)),ne={__name:"publish",setup(v){let h;const u=g("post"),x=g(),_=g(!1),r=g(),l=L({title:"",cover:"",descr:"",body:""}),S=O(()=>u.value=="post"?"技术区":"往昔册"),U=()=>{_.value=!0},D=async()=>{if(r.value){const o=new FormData;o.append("image",r.value);const i=await C("/api/file/upload-image",o);l.cover=i.data.src}const c=h.getMarkdown();l.body=c,u.value=="pastBooks"?(l.descr=l.text,(await Z("/api/pastBooks/create",l)).status==200&&(_.value=!1)):G(l).then(()=>{_.value=!1})},F=()=>{h=new $({el:document.querySelector("#editor"),height:"83vh",initialEditType:"markdown",previewStyle:"vertical",hooks:{addImageBlobHook:(c,o)=>{const i=new FormData;i.append("image",c),C("/api/file/upload-image",i).then(p=>{o(p.data.src,"")})}}})};return Q(()=>{F(),z().then(c=>{x.value=c.data})}),(c,o)=>{const i=a("v-app-bar-title"),p=a("v-btn"),b=a("v-container"),T=a("v-app-bar"),E=a("v-text-field"),V=a("v-card-title"),k=a("v-card-text"),w=a("v-card"),n=a("v-col"),y=a("v-radio"),N=a("v-radio-group"),f=a("v-row"),A=a("v-file-input"),j=a("v-select"),M=a("v-textarea"),q=a("v-img"),H=a("v-spacer"),J=a("v-card-actions"),P=a("v-dialog");return B(),R("div",null,[e(T,{density:"compact",style:{position:"static"}},{default:t(()=>[e(b,{class:"d-flex align-center"},{default:t(()=>[e(i,{class:"text-h5"},{default:t(()=>[d("文章发布")]),_:1}),e(p,{onClick:U,color:"blue"},{default:t(()=>[d("发布")]),_:1})]),_:1})]),_:1}),I("div",oe,[e(b,{class:"d-flex align-center"},{default:t(()=>[e(w,{style:{width:"100%",height:"100%"},flat:""},{default:t(()=>[e(V,null,{default:t(()=>[e(E,{modelValue:l.title,"onUpdate:modelValue":o[0]||(o[0]=m=>l.title=m),density:"compact",variant:"outlined",placeholder:"输入标题"},null,8,["modelValue"])]),_:1}),e(k,null,{default:t(()=>[le]),_:1})]),_:1})]),_:1})]),e(P,{"max-width":"700",modelValue:_.value,"onUpdate:modelValue":o[5]||(o[5]=m=>_.value=m)},{default:t(({isActive:m})=>[e(w,null,{default:t(()=>[e(V,null,{default:t(()=>[d(" 发布到: "+W(S.value),1)]),_:1}),e(k,null,{default:t(()=>[e(f,null,{default:t(()=>[e(n,{cols:"2"},{default:t(()=>[d("模块选择：")]),_:1}),e(n,{cols:"10"},{default:t(()=>[e(N,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=s=>u.value=s),inline:"","hide-details":""},{default:t(()=>[e(y,{label:"技术区",value:"post"}),e(y,{label:"往昔册",value:"pastBooks"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(n,{cols:"2"},{default:t(()=>[d("封面：")]),_:1}),e(n,{cols:"10"},{default:t(()=>[e(A,{modelValue:r.value,"onUpdate:modelValue":o[2]||(o[2]=s=>r.value=s),accept:"image/png, image/jpeg, image/bmp","prepend-icon":"","hide-details":"","prepend-inner-icon":"mdi-file-image",placeholder:"选择一张图片做封面吧",variant:"outlined",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1}),u.value=="post"?(B(),X(f,{key:0},{default:t(()=>[e(n,{cols:"2"},{default:t(()=>[d("分类：")]),_:1}),e(n,{cols:"10"},{default:t(()=>[e(j,{label:"分类",modelValue:l.captcha_id,"onUpdate:modelValue":o[3]||(o[3]=s=>l.captcha_id=s),items:x.value,"item-title":"name","item-value":"_id",variant:"outlined",density:"compact",multiple:"","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1})):Y("",!0),e(f,null,{default:t(()=>[e(n,{cols:"2"},{default:t(()=>[d("描述：")]),_:1}),e(n,{cols:"10"},{default:t(()=>[e(M,{modelValue:l.descr,"onUpdate:modelValue":o[4]||(o[4]=s=>l.descr=s),placeholder:"用简短的几句话总结一下这篇文章吧","hide-details":"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(q,{width:300,"aspect-ratio":"16/9",cover:"",src:r.value},null,8,["src"])]),_:1}),e(J,null,{default:t(()=>[e(H),e(p,{text:"取 消",color:"#F5F5F5",class:"text-none mb-4",variant:"flat",onClick:s=>m.value=!1},null,8,["onClick"]),e(p,{text:"确 定",color:"indigo-darken-3",class:"text-none mb-4",variant:"flat",onClick:D})]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])])}}},ie=K(ne,[["__scopeId","data-v-235aea46"]]);export{ie as default};
